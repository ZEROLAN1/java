# 📝 项目改进说明

## ✅ 已完成的修改

### 1. 添加多环境配置支持

创建了三个配置文件，支持不同场景：

#### 📄 application-dev.properties（开发环境）
- ✅ 使用H2内存数据库
- ✅ 无需安装MySQL
- ✅ 自动创建表结构
- ✅ 开启H2控制台（http://localhost:8080/h2-console）
- ⚠️ 数据重启后丢失（适合快速测试）

#### 📄 application-mysql.properties（本地MySQL）
- ✅ 使用本地MySQL数据库
- ✅ 数据持久化
- ✅ 更接近生产环境
- 📌 需要先安装MySQL并创建数据库

#### 📄 application-prod.properties（生产环境）
- ✅ 使用环境变量配置敏感信息
- ✅ 关闭SQL日志输出
- ✅ 更安全的配置方式
- 📌 适合服务器部署

### 2. 添加H2数据库支持

修改了 `pom.xml`：
```xml
<!-- H2 Database for local development -->
<dependency>
    <groupId>com.h2database</groupId>
    <artifactId>h2</artifactId>
    <scope>runtime</scope>
</dependency>
```

### 3. 优化文件上传服务

修改了 `FileService.java`：
- ✅ 使用配置文件中的上传路径
- ✅ 启动时自动创建上传目录
- ✅ 支持不同环境使用不同路径
- ✅ 添加初始化日志输出

### 4. 创建便捷启动脚本

#### Windows脚本：
- **start-local.bat** - 启动后端（H2数据库）
- **start-local-mysql.bat** - 启动后端（MySQL数据库）
- **start-frontend.bat** - 启动前端

#### Linux/Mac脚本：
- **start-local.sh** - 启动后端（H2数据库）
- **start-frontend.sh** - 启动前端

所有脚本包含：
- ✅ 环境检查
- ✅ 自动编译
- ✅ 友好的提示信息
- ✅ 错误处理

### 5. 创建完整文档

#### 📘 如何开始.md
- 新手友好的快速入门指南
- 三种运行方式对比
- 详细的步骤说明
- 常见问题解答

#### 📘 本地部署指南.md
- 详细的本地开发部署说明
- 三种部署方式（H2/MySQL/Docker）
- 开发调试技巧
- 完整的故障排查

#### 📘 CENTOS部署指南.md
- CentOS服务器完整部署教程
- Docker和手动部署两种方式
- 安全加固建议
- 运维管理命令

#### 📘 快速参考.md
- 一页纸快速参考
- 所有常用命令
- 快速故障排查
- 技术栈版本信息

---

## 🚀 如何在本地运行

### 方法1：最快速启动（推荐）

**前提条件：**
- ✅ 已安装 JDK 11 或更高版本（注意是JDK不是JRE）
- ✅ 已安装 Node.js 16+

**步骤：**

1. **检查环境**
   ```bash
   java -version   # 应显示 JDK 11+
   node -v         # 应显示 Node 16+
   ```

2. **启动后端**
   ```cmd
   # Windows
   双击运行: start-local.bat
   
   # Linux/Mac
   chmod +x start-local.sh
   ./start-local.sh
   ```

3. **启动前端**（新开窗口）
   ```cmd
   # Windows
   双击运行: start-frontend.bat
   
   # Linux/Mac
   chmod +x start-frontend.sh
   ./start-frontend.sh
   ```

4. **访问应用**
   - 前端：http://localhost:3000
   - 后端API：http://localhost:8080
   - H2控制台：http://localhost:8080/h2-console

### 方法2：使用Docker（最简单但需要Docker）

```bash
# 一键启动所有服务
docker-compose up -d

# 访问应用
http://localhost:8888
```

### 方法3：使用MySQL数据库（数据持久化）

1. **安装并启动MySQL**
2. **创建数据库**
   ```sql
   CREATE DATABASE cloud_storage;
   ```
3. **修改配置**
   编辑 `src/main/resources/application-mysql.properties`，设置MySQL密码
4. **启动应用**
   ```cmd
   # Windows
   start-local-mysql.bat
   
   # Linux/Mac
   java -jar target/cloud-storage-0.0.1-SNAPSHOT.jar --spring.profiles.active=mysql
   ```

---

## 🖥️ 如何部署到CentOS服务器

### 推荐方式：使用Docker

```bash
# 1. 安装Docker和Docker Compose
yum install -y docker
systemctl start docker
curl -L "https://github.com/docker/compose/releases/download/v2.20.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
chmod +x /usr/local/bin/docker-compose

# 2. 上传项目到服务器
git clone <your-repo-url>
cd java-cloud-storage

# 3. 修改 docker-compose.yml 中的密码（重要！）
vi docker-compose.yml
# 修改 SPRING_DATASOURCE_PASSWORD 和 MYSQL_ROOT_PASSWORD

# 4. 启动服务
docker-compose up -d

# 5. 配置防火墙
firewall-cmd --permanent --add-port=80/tcp
firewall-cmd --reload

# 6. 访问应用
# 浏览器打开: http://你的服务器IP
```

**详细步骤请查看：[CENTOS部署指南.md](./CENTOS部署指南.md)**

---

## 📋 环境切换说明

项目支持通过 `spring.profiles.active` 参数切换环境：

### 开发环境（H2数据库）
```bash
java -jar app.jar --spring.profiles.active=dev
```
- 无需MySQL
- 数据存在内存
- 最快速度启动

### MySQL环境
```bash
java -jar app.jar --spring.profiles.active=mysql
```
- 使用本地MySQL
- 数据持久化
- 需要MySQL服务

### 生产环境
```bash
export SPRING_DATASOURCE_PASSWORD=你的密码
export JWT_SECRET=$(openssl rand -base64 32)
java -jar app.jar --spring.profiles.active=prod
```
- 使用环境变量
- 更安全
- 适合服务器部署

---

## ❗ 重要提醒

### 1. JDK vs JRE

如果遇到编译错误：`No compiler is provided in this environment`

**原因：**安装的是JRE而不是JDK

**解决方法：**
1. 卸载JRE
2. 下载并安装JDK 11：https://www.oracle.com/java/technologies/downloads/
3. 配置环境变量 JAVA_HOME

**验证：**
```bash
javac -version   # 应显示javac的版本，证明JDK正确安装
```

### 2. 首次启动说明

**后端首次启动：**
- Maven会下载所有依赖包，可能需要5-10分钟
- 如果下载慢，请配置阿里云镜像（见文档）
- 看到"Started CloudStorageApplication"表示成功

**前端首次启动：**
- npm会安装所有依赖包，可能需要3-5分钟
- 如果下载慢，请配置淘宝镜像（见文档）
- 看到"Local: http://localhost:3000"表示成功

### 3. 生产环境安全

部署到服务器时，务必修改以下内容：

1. **MySQL密码**
   - docker-compose.yml 中的 MYSQL_ROOT_PASSWORD
   - docker-compose.yml 中的 SPRING_DATASOURCE_PASSWORD

2. **JWT密钥**
   - 生成随机密钥：`openssl rand -base64 32`
   - 通过环境变量设置：`export JWT_SECRET=生成的密钥`

3. **开放端口**
   - 配置防火墙只开放必要的端口（80、443）
   - 不要开放MySQL端口（3306）到公网

---

## 🎯 配置文件目录结构

```
src/main/resources/
├── application.properties              # 主配置，指定使用哪个profile
├── application-dev.properties          # 开发环境（H2数据库）⭐ 默认
├── application-mysql.properties        # 本地MySQL环境
└── application-prod.properties         # 生产环境
```

**默认使用dev配置**，可以通过以下方式切换：

1. **修改 application.properties**
   ```properties
   spring.profiles.active=mysql  # 改为mysql或prod
   ```

2. **启动时指定**
   ```bash
   java -jar app.jar --spring.profiles.active=prod
   ```

3. **使用环境变量**
   ```bash
   export SPRING_PROFILES_ACTIVE=prod
   java -jar app.jar
   ```

---

## 📚 文档索引

| 文档 | 适合人群 | 内容 |
|------|---------|------|
| **如何开始.md** | 新手 | 快速入门，基础操作 |
| **快速参考.md** | 所有人 | 一页纸快速查找命令 |
| **本地部署指南.md** | 开发者 | 详细本地开发说明 |
| **CENTOS部署指南.md** | 运维人员 | 服务器部署完整教程 |
| **快速开始.md** | 所有人 | 原有的快速开始文档 |

---

## 🔄 项目文件清单

### 新增文件

```
✅ src/main/resources/application-dev.properties
✅ src/main/resources/application-mysql.properties
✅ src/main/resources/application-prod.properties
✅ start-local.bat
✅ start-local-mysql.bat
✅ start-frontend.bat
✅ start-local.sh
✅ start-frontend.sh
✅ 如何开始.md
✅ 本地部署指南.md
✅ CENTOS部署指南.md
✅ 快速参考.md
✅ 项目改进说明.md（本文件）
```

### 修改文件

```
🔧 pom.xml - 添加H2数据库依赖
🔧 src/main/resources/application.properties - 简化为profile选择器
🔧 src/main/java/com/cloudstorage/service/FileService.java - 优化文件上传
```

---

## 🎉 开始使用

现在您已经了解了所有改进，可以开始使用了！

**最快方式：**
1. ✅ 确保安装了JDK 11+（不是JRE）
2. ✅ 双击 `start-local.bat`（Windows）或运行 `./start-local.sh`（Linux/Mac）
3. ✅ 新开窗口，双击 `start-frontend.bat` 或运行 `./start-frontend.sh`
4. ✅ 浏览器访问 http://localhost:3000

**遇到问题？**
- 📘 查看 [如何开始.md](./如何开始.md) 的常见问题部分
- 📘 查看 [本地部署指南.md](./本地部署指南.md) 的故障排查章节
- 📘 查看启动脚本的输出日志

---

## 📞 技术支持

如果您在使用过程中遇到任何问题：

1. **查看日志** - 后端和前端的启动日志
2. **检查环境** - JDK版本、Node.js版本
3. **查阅文档** - 项目提供的详细文档
4. **常见问题** - 各文档中的FAQ部分

**祝您使用愉快！** 🎊
